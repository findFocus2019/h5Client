(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-auth-login"],{"1e28":function(t,n,i){"use strict";i.r(n);var o=i("2f75"),e=i("bcc0");for(var u in e)"default"!==u&&function(t){i.d(n,t,function(){return e[t]})}(u);var a=i("2877"),s=Object(a["a"])(e["default"],o["a"],o["b"],!1,null,"9b59f35a",null);n["default"]=s.exports},"2f75":function(t,n,i){"use strict";var o=function(){var t=this,n=t.$createElement,i=t._self._c||n;return i("v-uni-view",{staticClass:"uni-bg-white uni-page-body"},[i("v-uni-view",{staticClass:"uni-padding-wrap uni-common-pt"},[i("v-uni-form",{staticClass:"uni-common-mt uni-common-pt",on:{submit:function(n){n=t.$handleEvent(n),t.formSubmit(n)}}},[i("v-uni-view",{staticClass:"uni-form-item uni-column uni-border-bottom"},[i("v-uni-input",{staticClass:"uni-input",attrs:{type:"text",required:"",placeholder:"请输入登录手机号码"},model:{value:t.postData.mobile,callback:function(n){t.$set(t.postData,"mobile",n)},expression:"postData.mobile"}})],1),i("v-uni-view",{staticClass:"uni-form-item uni-column uni-border-bottom"},[i("v-uni-view",{staticClass:"with-fun"},[i("v-uni-input",{staticClass:"uni-input",attrs:{required:"",placeholder:"请输入登录密码",password:t.showPassword},model:{value:t.postData.password,callback:function(n){t.$set(t.postData,"password",n)},expression:"postData.password"}}),i("v-uni-view",{staticClass:"uni-icon uni-icon-eye",class:[t.showPassword?"":"uni-active"],staticStyle:{"font-size":"36upx"},on:{click:function(n){n=t.$handleEvent(n),t.changePassword(n)}}})],1)],1),i("v-uni-view",{staticClass:"uni-common-mt uni-common-pl uni-common-pr"},[i("v-uni-button",{staticClass:"uni-border-btn-radius",attrs:{type:"warn",formType:"submit"}},[t._v("登录")])],1),i("v-uni-view",{staticClass:"uni-common-pl uni-common-pr uni-common-mt uni-center uni-flex"},[i("v-uni-view",{staticClass:"uni-column uni-flex-item uni-link"},[i("v-uni-text",{on:{click:function(n){n=t.$handleEvent(n),t.goAuthBind(0)}}},[t._v("没有账号去注册?")])],1),i("v-uni-view",{staticClass:"uni-column uni-flex-item uni-link",on:{click:function(n){n=t.$handleEvent(n),t.goAuthBind(1)}}},[i("v-uni-text",[t._v("忘记密码")])],1)],1)],1)],1),i("v-uni-view",{staticStyle:{position:"absolute",bottom:"0",width:"100%"}},[i("v-uni-view",{staticStyle:{height:"180upx"}},[t.hasProvider?i("v-uni-view",{staticClass:"uni-common-pa uni-common-mt uni-center uni-flex"},t._l(t.providerList,function(n,o){return i("v-uni-view",{key:o,staticClass:"uni-column uni-flex-item",on:{click:function(i){i=t.$handleEvent(i),t.oauth(n.value)}}},[i("v-uni-image",{staticStyle:{width:"120upx",height:"120upx"},attrs:{"lazy-load":"true",src:n.image}})],1)}),1):t._e()],1),i("v-uni-view",{staticClass:"uni-center uni-flex",staticStyle:{height:"100upx","line-height":"100upx"}},[i("v-uni-view",{staticClass:"uni-column uni-flex-item uni-link",on:{click:function(n){n=t.$handleEvent(n),t.goAuthBind(2)}}},[i("v-uni-text",[t._v("老用户入口")])],1),i("v-uni-view",{staticClass:"uni-column uni-flex-item uni-link",on:{click:function(n){n=t.$handleEvent(n),t.notLogin(n)}}},[i("v-uni-text",[t._v("暂不登录")])],1)],1)],1)],1)},e=[];i.d(n,"a",function(){return o}),i.d(n,"b",function(){return e})},bcc0:function(t,n,i){"use strict";i.r(n);var o=i("c082"),e=i.n(o);for(var u in o)"default"!==u&&function(t){i.d(n,t,function(){return o[t]})}(u);n["default"]=e.a},c082:function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=u(i("a34a")),e=u(i("57e2"));function u(t){return t&&t.__esModule?t:{default:t}}function a(t,n,i,o,e,u,a){try{var s=t[u](a),r=s.value}catch(c){return void i(c)}s.done?n(r):Promise.resolve(r).then(o,e)}function s(t){return function(){var n=this,i=arguments;return new Promise(function(o,e){var u=t.apply(n,i);function s(t){a(u,o,e,s,r,"next",t)}function r(t){a(u,o,e,s,r,"throw",t)}s(void 0)})}}var r={data:function(){return{postData:{mobile:"",password:"",auth_info:{}},hasProvider:!1,providerList:[],positionTop:0,showPassword:!0,oauth_info:{platform:"",device:"",avatar:"",nickname:"",openid:"",type:""}}},methods:{changePassword:function(){this.showPassword=!this.showPassword},formSubmit:function(){var t=s(o.default.mark(function t(){var n,i,u;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=this.postData,console.log("formSubmit postData",JSON.stringify(n)),uni.showLoading({title:"正在登录..."}),t.next=5,e.default.post("auth/login",n);case 5:i=t.sent,console.log("formSubmit ret",JSON.stringify(i)),uni.hideLoading(),0==i.code?(uni.showToast({title:"登录成功",duration:1500,icon:"success"}),u=i.data.token,console.log("formSbumit token",u),uni.setStorageSync("user_auth_token",u),this.$store.state.hasLogin=!0,this.$store.dispatch("userInfoGet"),setTimeout(function(){uni.navigateBack({delta:1})},1e3)):uni.showToast({title:"登录失败,"+i.message,duration:1500,icon:"none"});case 9:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),oauth:function(){var t=s(o.default.mark(function t(){var n,i=this,u=arguments;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:n=u.length>0&&void 0!==u[0]?u[0]:"",console.log("oauth type :",n),uni.login({provider:n,success:function(t){console.log("login res =========",JSON.stringify(t)),"sinaweibo"==n&&(i.oauth_info.openid=t.authResult.uid),uni.getUserInfo({provider:n,withCredentials:!0,success:function(){var t=s(o.default.mark(function t(n){var u,a,s;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return console.log(JSON.stringify(n)),u=n.userInfo,i.oauth_info.avatar=u.avatarUrl,i.oauth_info.nickname=u.nickName,u.openid&&(i.oauth_info.openid=u.openid),u.openId&&(i.oauth_info.openid=u.openId),console.log(JSON.stringify(i.oauth_info)),t.next=9,e.default.post("auth/loginOauth",i.oauth_info);case 9:a=t.sent,0==a.code?(uni.showToast({title:"授权登录成功",duration:1500,icon:"success"}),s=a.data.token,console.log("loginOauth token",s),uni.setStorageSync("user_auth_token",s),i.$store.state.hasLogin=!0,i.$store.dispatch("userInfoGet"),setTimeout(function(){uni.navigateBack({delta:1})},1e3)):2==a.code?(i.$store.state.oAuthId=a.data.oauth_id,i.goAuthBind(3)):uni.showToast({title:"授权登录失败,请稍后重试",duration:1500,icon:"none"});case 11:case"end":return t.stop()}},t,this)}));function n(n){return t.apply(this,arguments)}return n}(),fail:function(t){console.error("授权登录失败，",JSON.stringify(t)),uni.showToast({title:"授权登录失败,获取用户信息出错",duration:1500,icon:"none"})}})},fail:function(t){console.error("授权登录失败:"+JSON.stringify(t)),uni.showToast({title:"授权登录失败, "+t.errMsg||!1,duration:1500,icon:"none"})}});case 3:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),initProvider:function(){var t=this,n=["weixin","qq","sinaweibo"];uni.getProvider({service:"oauth",success:function(i){if(i.provider&&i.provider.length){for(var o=0;o<i.provider.length;o++)~n.indexOf(i.provider[o])&&t.providerList.push({value:i.provider[o],image:"../../static/icon/"+i.provider[o]+".png"});t.hasProvider=!0}},fail:function(t){console.error("获取服务供应商失败："+JSON.stringify(t))}})},initPosition:function(){var t=uni.getSystemInfoSync();console.log("systemInfo :"+JSON.stringify(t)),this.positionTop=t.windowHeight-140,console.log("positionTop",this.positionTop)},notLogin:function(){uni.navigateBack({delta:1})},goAuthBind:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;uni.setStorageSync("auth_reg_type",t),1==t?uni.navigateTo({url:"../auth/register"}):uni.redirectTo({url:"../auth/register"})}},onLoad:function(){this.initProvider(),this.initPosition(),this.$store.state.hasLogin=!1,uni.setStorageSync("user_auth_token",""),uni.redirectTo({url:"/pages/auth/sign"})},onShow:function(){var t=uni.getSystemInfoSync(),n="";n="h5",this.postData.auth_info={platform:t.platform,device:t.model,type:n},this.oauth_info.platform=t.platform,this.oauth_info.device=t.model,this.oauth_info.type=n}};n.default=r}}]);