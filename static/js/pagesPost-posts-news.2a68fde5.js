(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pagesPost-posts-news"],{6900:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("a34a")),i=n("2f62");function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n,s,i,r,a){try{var o=t[r](a),c=o.value}catch(l){return void n(l)}o.done?e(c):Promise.resolve(c).then(s,i)}function o(t){return function(){var e=this,n=arguments;return new Promise(function(s,i){var r=t.apply(e,n);function o(t){a(r,s,i,o,c,"next",t)}function c(t){a(r,s,i,o,c,"throw",t)}o(void 0)})}}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},s=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),s.forEach(function(e){l(t,e,n[e])})}return t}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u={data:function(){return{channels:[{id:"all",name:"全部"}],currentIndex:0,scrollTop:0,scrollLeft:0,swiperHeight:0,newsItems:{},showLoadMore:!1,loadMoreText:"",refreshDisplay:"none"}},computed:c({},(0,i.mapState)(["postChannels","newsDatas"])),onLoad:function(){var t=o(s.default.mark(function t(e){var n,i,r,a,o=this;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.channel||"all",this.newsItems=this.newsDatas,this.postChannels.length){t.next=5;break}return t.next=5,this.$store.dispatch("postChannelsGet",{type:1});case 5:for({},i=0;i<this.postChannels.length;i++)r=this.postChannels[i],this.channels.push({id:r,name:r}),r==n&&(this.currentIndex=i+1);if(this.currentIndex>=5?this.scrollLeft=75*this.currentIndex:this.scrollLeft=0,console.log(this.scrollLeft,"scrollLeftscrollLeftscrollLeftscrollLeftscrollLeftscrollLeft"),this.newsItems[n]&&this.newsItems[n].list&&this.newsItems[n].list.length){t.next=16;break}return a=this.channels[this.currentIndex],this.refreshDisplay="block",t.next=14,this.getNewsData(a,!0);case 14:t.sent,setTimeout(function(){o.refreshDisplay="none"},500);case 16:console.log(this.newsItems,!0);case 17:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onReady:function(){var t=o(s.default.mark(function t(){var e,n=this;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e=uni.createSelectorQuery().select(".uni-page-body"),e.fields({size:!0,scrollOffset:!0},function(t){console.log("得到节点信息"+JSON.stringify(t)),console.log("节点的宽为"+t.width),n.swiperHeight=t.height-50+"px"}).exec();case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{getChannelData:function(){var t=o(s.default.mark(function t(e){var n,i=this;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.newsItems[e]&&this.newsItems[e].list&&this.newsItems[e].list.length){t.next=7;break}return n=this.channels[this.currentIndex],this.refreshDisplay="block",t.next=5,this.getNewsData(n,!0);case 5:t.sent,setTimeout(function(){i.refreshDisplay="none"},500);case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),tapChannel:function(){var t=o(s.default.mark(function t(e,n){return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.currentIndex=n;case 1:case"end":return t.stop()}},t,this)}));function e(e,n){return t.apply(this,arguments)}return e}(),changeTab:function(){var t=o(s.default.mark(function t(e){var n,i;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return console.log("changeTab",e),n=e.detail.current,this.currentIndex=n,this.scrollLeft=n>=5?75*n:0,i=this.channels[n],t.next=7,this.getChannelData(i.id);case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),goToDetail:function(t){uni.navigateTo({url:"/pagesPost/posts/detail?id="+t.id})},refresh:function(){var t=o(s.default.mark(function t(e){var n,i,r,a=this;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("refresh",e.id),n=this.newsItems[e.id]||{},i=n.timestamp||0,r=parseInt(Date.now()/1e3),!(i&&r-i<900)){t.next=7;break}return console.log("refresh stop"),t.abrupt("return");case 7:return this.refreshDisplay="block",t.next=10,this.getNewsData(e,!0);case 10:t.sent,setTimeout(function(){a.refreshDisplay="none"},500);case 12:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),getNewsData:function(){var t=o(s.default.mark(function t(e){var n,i,r,a,o,c,l,u,h,f=arguments;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=f.length>1&&void 0!==f[1]&&f[1],i=e.id,r=parseInt(Date.now()/1e3),console.log("channel",i),a=this.newsItems[i],o={},o.type=1,a||(this.newsItems[i]={},this.newsItems[i].list=[]),a&&a.list.length?(o.page=a.page,o.channel=i,o.timestamp=a.timestamp):(o.page=1,o.channel=i,o.timestamp=r),n&&(o.page=1,o.channel=i,o.timestamp=r,this.newsItems[i].list=[]),console.log("params",o),t.next=13,this.$store.dispatch("postListGet",o);case 13:if(c=t.sent,0==c.code)for(l=c.data,u=l.rows,this.newsItems[i].count=l.count,this.newsItems[i].page=l.page+1,this.newsItems[i].timestamp=l.timestamp,h=0;h<u.length;h++)this.newsItems[i].list.push(u[h]);return t.abrupt("return",c);case 16:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),loadMore:function(){var t=o(s.default.mark(function t(e){var n,i=this;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return console.log("load more ..."),this.showLoadMore=!0,this.loadMoreText="加载更多...",t.next=5,this.getNewsData(e);case 5:n=t.sent,0==n.data.rows.length?(this.loadMoreText="无更多",setTimeout(function(){i.showLoadMore=!1,i.loadMoreText=""},1500)):(this.showLoadMore=!1,this.loadMoreText="");case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}()}};e.default=u},7629:function(t,e,n){e=t.exports=n("2350")(!1),e.push([t.i,'@charset "UTF-8";\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.swiper-tab-list.active[data-v-d60fffc6]{color:#d81e06}.news-swiper[data-v-d60fffc6]{display:block;height:100%}.news-swiper .news-swiper-item[data-v-d60fffc6]{height:100%}.scroll-Y .scroll-view-item[data-v-d60fffc6]{height:%?600?%}',""])},"858f":function(t,e,n){var s=n("7629");"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var i=n("4f06").default;i("027ab17a",s,!0,{sourceMap:!1,shadowMode:!1})},"8d6f":function(t,e,n){"use strict";var s=n("858f"),i=n.n(s);i.a},c1a4:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"uni-page-body uni-bg-white uni-border-top"},[n("v-uni-scroll-view",{staticClass:"uni-swiper-tab news-channels",attrs:{"scroll-x":"true","scroll-left":t.scrollLeft}},t._l(t.channels,function(e,s){return n("v-uni-view",{key:s,class:["swiper-tab-list",t.currentIndex==s?"active":""],on:{click:function(n){n=t.$handleEvent(n),t.tapChannel(e,s)}}},[t._v(t._s(e.name))])})),n("v-uni-view",{staticClass:"uni-common-pa uni-center",style:{display:t.refreshDisplay}},[t._v("加载中...")]),n("v-uni-swiper",{staticClass:"swiper-box",style:{height:t.swiperHeight},attrs:{"indicator-dots":!1,autoplay:!1,interval:3e3,duration:500,current:t.currentIndex},on:{change:function(e){e=t.$handleEvent(e),t.changeTab(e)}}},t._l(t.channels,function(e,s){return n("v-uni-swiper-item",{key:s},[n("v-uni-view",{staticClass:"swiper-item news-swiper-item"},[t.newsItems[e.id]&&t.newsItems[e.id].count?n("v-uni-scroll-view",{staticClass:"scroll-Y",style:{height:t.swiperHeight},attrs:{"scroll-top":t.scrollTop,"scroll-y":"true"},on:{scrolltoupper:function(n){n=t.$handleEvent(n),t.refresh(e)},scrolltolower:function(n){n=t.$handleEvent(n),t.loadMore(e)}}},t._l(t.newsItems[e.id].list,function(e,s){return n("v-uni-view",{key:s,staticClass:"uni-bg-white uni-common-pl uni-common-pr"},[n("v-uni-view",{staticClass:"uni-common-pt uni-common-pb uni-border-bottom",on:{click:function(n){n=t.$handleEvent(n),t.goToDetail(e)}}},[n("v-uni-view",{staticClass:"uni-flex"},t._l(e.imgs,function(e,s){return s<3?n("v-uni-view",{key:s,staticClass:"uni-common-mr"},[n("v-uni-image",{staticClass:"post-list-cover-inline",attrs:{"lazy-load":"true",src:e.url,mode:"scaleToFill"}})],1):t._e()})),n("v-uni-view",{staticClass:"post-list-content-inline"},[n("v-uni-view",{staticClass:"uni-bold title"},[t._v(t._s(e.title))]),n("v-uni-view",{staticClass:"uni-text-gray uni-flex icon-items"},[n("v-uni-view",{staticClass:"icon-img"},[n("v-uni-image",{staticClass:"icon-img",attrs:{"lazy-load":"true",src:"/static/icon/posts/eye.png",mode:""}})],1),n("v-uni-view",{staticClass:"uni-flex-item "},[n("v-uni-text",[t._v(t._s(e.views))])],1),n("v-uni-view",{staticClass:"icon-img"},[n("v-uni-image",{staticClass:"icon-img",attrs:{"lazy-load":"true",src:"/static/icon/posts/zan.png",mode:""}})],1),n("v-uni-view",{staticClass:"uni-flex-item"},[n("v-uni-text",[t._v(t._s(e.likes))])],1),n("v-uni-view",{staticClass:"icon-img"},[n("v-uni-image",{staticClass:"icon-img",attrs:{"lazy-load":"true",src:"/static/icon/posts/share.png",mode:""}})],1),n("v-uni-view",{staticClass:"uni-flex-item"},[n("v-uni-text",[t._v(t._s(e.shares))])],1)],1)],1)],1)],1)})):t._e()],1)],1)})),t.showLoadMore?n("v-uni-view",{staticClass:"uni-center uni-common-pa"},[t._v(t._s(t.loadMoreText))]):t._e()],1)},i=[];n.d(e,"a",function(){return s}),n.d(e,"b",function(){return i})},d139:function(t,e,n){"use strict";n.r(e);var s=n("c1a4"),i=n("d2f0");for(var r in i)"default"!==r&&function(t){n.d(e,t,function(){return i[t]})}(r);n("8d6f");var a=n("2877"),o=Object(a["a"])(i["default"],s["a"],s["b"],!1,null,"d60fffc6",null);e["default"]=o.exports},d2f0:function(t,e,n){"use strict";n.r(e);var s=n("6900"),i=n.n(s);for(var r in s)"default"!==r&&function(t){n.d(e,t,function(){return s[t]})}(r);e["default"]=i.a}}]);