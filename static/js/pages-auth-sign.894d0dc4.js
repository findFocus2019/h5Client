(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-auth-sign"],{"00da":function(t,i,n){var e=n("a5b3");"string"===typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);var s=n("4f06").default;s("2b994061",e,!0,{sourceMap:!1,shadowMode:!1})},"01c3":function(t,i,n){"use strict";n.r(i);var e=n("cc6a"),s=n.n(e);for(var o in e)"default"!==o&&function(t){n.d(i,t,function(){return e[t]})}(o);i["default"]=s.a},"1d7c":function(t,i,n){"use strict";var e=n("00da"),s=n.n(e);s.a},"635d":function(t,i,n){"use strict";n.r(i);var e=n("8bcd"),s=n("01c3");for(var o in s)"default"!==o&&function(t){n.d(i,t,function(){return s[t]})}(o);n("1d7c");var a=n("2877"),u=Object(a["a"])(s["default"],e["a"],e["b"],!1,null,"519581d2",null);i["default"]=u.exports},"8bcd":function(t,i,n){"use strict";var e=function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("v-uni-view",{staticClass:"uni-bg-white uni-page-body"},[n("v-uni-view",{staticClass:"uni-padding-wrap uni-common-pt"},[n("v-uni-form",{staticClass:"uni-common-mt uni-common-pt",on:{submit:function(i){i=t.$handleEvent(i),t.formSubmit(i)}}},[n("v-uni-view",{staticClass:"uni-form-item uni-column uni-border-bottom"},[n("v-uni-input",{staticClass:"uni-input",attrs:{type:"text",required:"",placeholder:"请输入登录手机号码"},model:{value:t.postData.mobile,callback:function(i){t.$set(t.postData,"mobile",i)},expression:"postData.mobile"}})],1),n("v-uni-view",{staticClass:"uni-flex uni-border-bottom uni-form-item"},[n("v-uni-view",{staticClass:"uni-flex-item uni-column"},[n("v-uni-input",{staticClass:"uni-input",attrs:{type:"password",required:"",placeholder:"请输入验证码",maxlength:"6"},model:{value:t.postData.verify_code,callback:function(i){t.$set(t.postData,"verify_code",i)},expression:"postData.verify_code"}})],1),n("v-uni-view",{staticClass:"uni-common-pl uni-common-pr "},[n("v-uni-view",{staticClass:"uni-border-btn-radius uni-center btn-sms",on:{click:function(i){i=t.$handleEvent(i),t.smsSendClick(i)}}},[t._v(t._s(t.sms.text))])],1)],1),t.signType&&t.pid>0?n("v-uni-view",{staticClass:"uni-flex uni-border-bottom uni-common-pa uni-text-gray"},[n("v-uni-view",{},[t._v("邀请人手机号："+t._s(t.inviteUser.mobile))])],1):t._e(),n("v-uni-view",{staticClass:"uni-flex uni-common-mt uni-common-pa"},[n("v-uni-view",{},[n("v-uni-checkbox",{on:{click:function(i){i=t.$handleEvent(i),t.checkChange(i)}}})],1),n("v-uni-view",{staticClass:"uni-flex-item uni-text-light"},[t._v("我已阅读并同意"),n("v-uni-text",{staticClass:"uni-text-red",on:{click:function(i){i=t.$handleEvent(i),t.goToAgree(i)}}},[t._v("《用户使用协议》")])],1)],1),n("v-uni-view",{staticClass:"uni-common-mt uni-common-pl uni-common-pr"},[n("v-uni-button",{staticClass:"uni-border-btn-radius",attrs:{type:"warn",formType:"submit"}},[t._v(t._s(t.signText))])],1),3!=t.signType?n("v-uni-view",{staticClass:"uni-common-pl uni-common-pr uni-common-mt uni-center uni-flex"},[n("v-uni-view",{staticClass:"uni-column uni-flex-item uni-link"},[n("v-uni-text",{on:{click:function(i){i=t.$handleEvent(i),t.changeSignType(i)}}},[t._v(t._s(t.signChangeText))])],1),n("v-uni-view",{staticClass:"uni-column uni-flex-item uni-link",on:{click:function(i){i=t.$handleEvent(i),t.notLogin(i)}}},[n("v-uni-text",[t._v("暂不登录")])],1)],1):t._e()],1)],1),0==t.signType?n("v-uni-view",{staticStyle:{position:"absolute",top:"800upx",width:"100%"}},[n("v-uni-view",{staticStyle:{height:"180upx"}},[t.hasProvider?n("v-uni-view",{staticClass:"uni-common-pa uni-common-mt uni-center uni-flex"},t._l(t.providerList,function(i,e){return n("v-uni-view",{key:e,staticClass:"uni-column uni-flex-item",on:{click:function(n){n=t.$handleEvent(n),t.oauth(i.value)}}},[n("v-uni-image",{staticStyle:{width:"120upx",height:"120upx"},attrs:{"lazy-load":"true",src:i.image}})],1)}),1):t._e()],1),n("v-uni-view",{staticClass:"uni-center uni-text-gray uni-common-pb"},[t._v("快捷登录")])],1):t._e()],1)},s=[];n.d(i,"a",function(){return e}),n.d(i,"b",function(){return s})},a5b3:function(t,i,n){i=t.exports=n("2350")(!1),i.push([t.i,".btn-sms[data-v-519581d2]{width:%?200?%;height:%?80?%;line-height:%?80?%;border:%?1?% solid #d81e06;border-radius:%?40?%;color:#d81e06}",""])},cc6a:function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var e=o(n("a34a")),s=o(n("57e2"));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,i,n,e,s,o,a){try{var u=t[o](a),r=u.value}catch(c){return void n(c)}u.done?i(r):Promise.resolve(r).then(e,s)}function u(t){return function(){var i=this,n=arguments;return new Promise(function(e,s){var o=t.apply(i,n);function u(t){a(o,e,s,u,r,"next",t)}function r(t){a(o,e,s,u,r,"throw",t)}u(void 0)})}}var r={data:function(){return{signText:"登录",signType:0,signChangeText:"没有账号去注册?",pid:0,isReg:0,postData:{mobile:"",verify_code:"",auth_info:{}},sms:{text:"获取验证码",second:60,click:0},inviteUser:{mobile:""},hasProvider:!1,providerList:[],positionTop:0,showPassword:!0,oauth_info:{platform:"",device:"",avatar:"",nickname:"",openid:"",type:""}}},computed:{oAuthId:function(){return this.$store.state.oAuthId},inviteUserId:function(){return this.$store.state.inviteUserId}},methods:{checkChange:function(){this.checked=!this.checked,console.log("checkChange",this.checked)},goToAgree:function(){uni.navigateTo({url:"/pagesMain/user/agreement"})},smsSendClick:function(){var t=u(e.default.mark(function t(){return e.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.sms.click||this.smsSend();case 1:case"end":return t.stop()}},t,this)}));function i(){return t.apply(this,arguments)}return i}(),smsSend:function(){var t=u(e.default.mark(function t(){var i,n=this;return e.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(60!=this.sms.second){t.next=15;break}if(console.log("sms send ... ..."),this.postData.mobile&&11==this.postData.mobile.length){t.next=5;break}return uni.showToast({icon:"none",title:"输入正确手机号"}),t.abrupt("return");case 5:return this.sms.click=1,t.next=8,this.$store.dispatch("sendSmsCode",{mobile:this.postData.mobile});case 8:if(i=t.sent,0!=i.code){t.next=13;break}uni.showToast({icon:"success",title:"验证码发送成功"}),t.next=15;break;case 13:return uni.showToast({icon:"none",title:i.message}),t.abrupt("return");case 15:0==this.sms.second?(this.sms.second=60,this.sms.text="发送",this.sms.click=0):(this.sms.text="("+this.sms.second--+"s)",console.log("sms send ... ...",this.sms.second),60!=this.sms.second&&setTimeout(function(){n.smsSend()},1e3));case 16:case"end":return t.stop()}},t,this)}));function i(){return t.apply(this,arguments)}return i}(),formSubmit:function(){var t=u(e.default.mark(function t(){var i,n,o,a=this;return e.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.checked){t.next=3;break}return uni.showToast({title:"请阅读并同意《用户使用协议》",duration:2e3,icon:"none"}),t.abrupt("return");case 3:return i=this.postData,console.log("formSubmit postData",JSON.stringify(i)),this.signType&&(i.pid=this.inviteUserId||0,this.oAuthId&&(i.oauth_info=this.oauth_info,i.oauth_info.oauth_id=this.oAuthId)),console.log("formSubmit postData",JSON.stringify(i)),uni.showLoading({title:"正在登录..."}),t.next=10,s.default.post("auth/sign",i);case 10:n=t.sent,console.log("formSubmit ret",JSON.stringify(n)),uni.hideLoading(),0==n.code?(uni.showToast({title:"登录成功",duration:1500,icon:"success"}),o=n.data.token,console.log("formSbumit token",o),uni.setStorageSync("user_auth_token",o),this.$store.state.hasLogin=!0,this.$store.dispatch("userInfoGet"),setTimeout(function(){a.isReg?uni.switchTab({url:"/pages/main/main"}):uni.navigateBack({delta:1})},2e3)):uni.showToast({title:"登录失败,"+n.message,duration:1500,icon:"none"});case 14:case"end":return t.stop()}},t,this)}));function i(){return t.apply(this,arguments)}return i}(),oauth:function(){var t=u(e.default.mark(function t(){var i,n=this,o=arguments;return e.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:i=o.length>0&&void 0!==o[0]?o[0]:"",console.log("oauth type :",i),uni.login({provider:i,success:function(t){console.log("login res =========",JSON.stringify(t)),"sinaweibo"==i&&(n.oauth_info.openid=t.authResult.uid),uni.getUserInfo({provider:i,withCredentials:!0,success:function(){var t=u(e.default.mark(function t(i){var o,a,u;return e.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return console.log(JSON.stringify(i)),o=i.userInfo,n.oauth_info.avatar=o.avatarUrl,n.oauth_info.nickname=o.nickName,o.openid&&(n.oauth_info.openid=o.openid),o.openId&&(n.oauth_info.openid=o.openId),console.log(JSON.stringify(n.oauth_info)),t.next=9,s.default.post("auth/loginOauth",n.oauth_info);case 9:a=t.sent,0==a.code?(uni.showToast({title:"授权登录成功",duration:1500,icon:"success"}),u=a.data.token,console.log("loginOauth token",u),uni.setStorageSync("user_auth_token",u),n.$store.state.hasLogin=!0,n.$store.dispatch("userInfoGet"),setTimeout(function(){uni.navigateBack({delta:1})},1e3)):2==a.code?(n.$store.state.oAuthId=a.data.oauth_id,n.signType=3,n.signText="第三方登录绑定",n.signChangeText=""):uni.showToast({title:"授权登录失败,请稍后重试",duration:1500,icon:"none"});case 11:case"end":return t.stop()}},t,this)}));function i(i){return t.apply(this,arguments)}return i}(),fail:function(t){console.error("授权登录失败，",JSON.stringify(t)),uni.showToast({title:"授权登录失败,获取用户信息出错",duration:1500,icon:"none"})}})},fail:function(t){console.error("授权登录失败:"+JSON.stringify(t)),uni.showToast({title:"授权登录失败, "+t.errMsg||!1,duration:1500,icon:"none"})}});case 3:case"end":return t.stop()}},t,this)}));function i(){return t.apply(this,arguments)}return i}(),initProvider:function(){var t=this,i=["weixin","qq","sinaweibo"];uni.getProvider({service:"oauth",success:function(n){if(n.provider&&n.provider.length){for(var e=0;e<n.provider.length;e++)~i.indexOf(n.provider[e])&&t.providerList.push({value:n.provider[e],image:"../../static/icon/"+n.provider[e]+".png"});t.hasProvider=!0}},fail:function(t){console.error("获取服务供应商失败："+JSON.stringify(t))}})},initPosition:function(){var t=uni.getSystemInfoSync();console.log("systemInfo :"+JSON.stringify(t)),this.positionTop=t.windowHeight-140,console.log("positionTop",this.positionTop)},changeSignType:function(){this.signType=this.signType?0:1,this.signType?(this.signText="注册",this.signChangeText="返回登录"):(this.signText="登录",this.signChangeText="没有账号去注册?"),uni.setNavigationBarTitle({title:this.signText})},notLogin:function(){uni.navigateBack({delta:1})},goAuthBind:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;uni.setStorageSync("auth_reg_type",t),1==t?uni.navigateTo({url:"../auth/register"}):uni.redirectTo({url:"../auth/register"})}},onLoad:function(){var t=u(e.default.mark(function t(i){var n,s,o;return e.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.initProvider(),this.initPosition(),this.$store.state.hasLogin=!1,uni.setStorageSync("user_auth_token",""),n=i.sign_type||0,this.signType=n,3==n?(this.signText="第三方登录绑定",this.signChangeText="",this.isReg=1):1==n?(this.signText="注册",this.signChangeText="返回登录",this.isReg=1):(this.signText="登录",this.signChangeText="没有账号去注册?"),uni.setNavigationBarTitle({title:this.signText}),s=this.$store.state.inviteUserId,this.pid=s,console.log("pid==========",s),!s){t.next=16;break}return t.next=14,this.$store.dispatch("getInviteUser",{pid:s});case 14:o=t.sent,0==o.code&&(this.inviteUser.mobile=o.data.mobile);case 16:case"end":return t.stop()}},t,this)}));function i(i){return t.apply(this,arguments)}return i}(),onShow:function(){var t=uni.getSystemInfoSync(),i="";i="h5",this.postData.auth_info={platform:t.platform,device:t.model,type:i},this.oauth_info.platform=t.platform,this.oauth_info.device=t.model,this.oauth_info.type=i}};i.default=r}}]);